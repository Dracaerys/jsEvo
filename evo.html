<!DOCTYPE HTML>
<html>
<head>
	<style>
		body {
			background-color: #4d90fe;
		}

		canvas {
			position: absolute;
			border: 1px solid black;
			background-color: #fff;
			top: 50%;
			left: 50%;
			margin: -394px 0 0 -512px;
		}
	</style>
</head>
<body>
	<div>
		<canvas id="c" width="1024" height="768" border="1px"></canvas>
	</div>
	<script>

		var cells = [];
		var food = [];
		var survivors = [];
		var test = [];
		
		var c = document.getElementById("c");
		var ctx = c.getContext("2d");

		function HSVtoRGB(h, s, v) {
			var r, g, b, i, f, p, q, t;
			if (arguments.length === 1) {
				s = h.s, v = h.v, h = h.h;
			}
			i = Math.floor(h * 6);
			f = h * 6 - i;
			p = v * (1 - s);
			q = v * (1 - f * s);
			t = v * (1 - (1 - f) * s);
			switch (i % 6) {
				case 0: r = v, g = t, b = p; break;
				case 1: r = q, g = v, b = p; break;
				case 2: r = p, g = v, b = t; break;
				case 3: r = p, g = q, b = v; break;
				case 4: r = t, g = p, b = v; break;
				case 5: r = v, g = p, b = q; break;
			}
			return "rgb(" + Math.round(r * 255) + "," + Math.round(g * 255) + "," + Math.round(b * 255) + ")"; 

		}

		function getRandomColor() {
			phi_conj = 0.618033988749895;
			h = Math.random();
			h += phi_conj;
			h %= 1;
			return HSVtoRGB(h, 0.5, 0.95);
		}

		function Cell(speed, d, color, x, y, hasEaten, target) {
			this.speed = speed;
			this.d = d;
			this.x = Math.floor(Math.random() * c.width);
			this.y = Math.floor(Math.random() * c.height);
			this.color = getRandomColor();
		}

		function Food(rad, x, y, remaining) {
			this.rad = rad;
			this.x = Math.floor(Math.random() * c.width);
			this.y = Math.floor(Math.random() * c.height);
			this.remaining = 0;
		}

		function drawCell(cell) {
			ctx.beginPath();
			ctx.arc(cells[cell].x, cells[cell].y, cells[cell].d, 0, 2*Math.PI);
			ctx.fillStyle = cells[cell].color;
			ctx.fill();
			ctx.stroke();
		}

		for (i=0; i<10; i++) {    
			cells[i] = new Cell(Math.floor(Math.random() * 25 + 5), Math.floor(Math.random() * 10 + 5));	// Create cells
		}
		
		for (i=0; i<5; i++) {    
			food[i] = new Food(10);	// Create food
		}

		function drawFood(foodNum) {
			ctx.beginPath();
			ctx.fillStyle = "rgb(0, 255, 0)";
			food[foodNum].rad = 20 - 4 * food[foodNum].remaining;
			ctx.arc(food[foodNum].x, food[foodNum].y, food[foodNum].rad, 0, 2*Math.PI);
			ctx.stroke();
			ctx.fill();
		}

		function move(cellnum) {
			var cell = cells[cellnum];
			for (k=0; k<5; k++) {	
				var dx = cell.x - food[k].x; 
				var dy = cell.y - food[k].y;
				test[k] = Math.sqrt(dx*dx + dy*dy);
				cell.target = test.indexOf(Math.min.apply(null, test));
			}
			var speed = cell.speed;
			
			var dx = cell.x - food[cell.target].x;
			var dy = cell.y - food[cell.target].y;

			var incrementX = dx / speed;
			var incrementY = dy / speed; 
			
			cell.x = cell.x - (incrementX / speed);
			cell.y = cell.y - (incrementY / speed);

			drawCell(cellnum);
		}

		function collide(cellnum) {
			var cell = cells[cellnum];
			var radius = cell.d / 2;
			
			if (Math.abs(food[cell.target].x - cell.x) <= cell.d + food[cell.target].rad && Math.abs(food[cell.target].y - cell.y) <= cell.d + food[cell.target].rad && cell.hasEaten != true && food[cell.target].remaining < 5) {  
				cell.hasEaten = true;
				survivors[food[cell.target].remaining] = cellnum;
				food[cell.target].remaining++;
				//console.log(food[0].remaining);
			}
		}

		function draw() {
			ctx.clearRect(0, 0, c.width, c.height); // Clear canvas.
			for (i=0; i<cells.length; i++) {
				move(i);
				collide(i);
			}
			for (i=0; i < food.length; i++) {
				drawFood(i);
			}
			window.requestAnimationFrame(draw); // Find some alternative.
		} 


		window.requestAnimationFrame(draw);  // Start animation.

</script>
</body>